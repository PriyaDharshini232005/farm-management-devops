<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Farm Management System</title>

<head>
<meta charset="UTF-8">
<title>Ultimate Irrigation Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background: linear-gradient(rgba(0,0,0,0.85),rgba(0,0,0,0.85)),
              url("https://images.unsplash.com/photo-1500382017468-9049fed747ef");
  background-size:cover;
  color:white;
}

.container{
  width:95%;
  margin:auto;
  padding:20px;
}

h1{text-align:center;margin-bottom:10px;}

/* Navigation Buttons */
.nav-buttons{
  display:flex;
  justify-content:space-between;
  margin-bottom:20px;
}

.nav-buttons button{
  background:rgba(255,255,255,0.15);
  backdrop-filter:blur(8px);
  color:white;
  padding:6px 15px;
  border-radius:20px;
  font-size:13px;
  border:none;
  cursor:pointer;
  transition:0.3s;
}

.nav-buttons button:hover{
  background:rgba(0,255,150,0.4);
}

/* Glass Form */
.glass{
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(15px);
  padding:20px;
  border-radius:15px;
  margin-bottom:20px;
  text-align:center;
}

select,input{
  padding:10px;
  margin:5px;
  border:none;
  border-radius:8px;
}

button{
  padding:8px 18px;
  border:none;
  border-radius:8px;
  background:linear-gradient(45deg,#00c853,#64dd17);
  color:white;
  cursor:pointer;
}

/* Cards */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:15px;
  margin-bottom:20px;
}

.card{
  background:rgba(255,255,255,0.1);
  padding:15px;
  border-radius:12px;
  text-align:center;
}

/* Table */
table{
  width:100%;
  border-collapse:collapse;
  background:rgba(255,255,255,0.08);
  margin-bottom:30px;
}

th,td{
  padding:10px;
  text-align:center;
}

th{background:rgba(255,255,255,0.15);}

.action-btn{
  padding:5px 10px;
  margin:2px;
  border:none;
  border-radius:5px;
  cursor:pointer;
}

.delete{background:#e53935;color:white;}
.edit{background:#039be5;color:white;}

/* Chart Section */
.chart-section{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
  gap:20px;
  margin-top:20px;
}

.chart-box{
  background:rgba(255,255,255,0.05);
  padding:15px;
  border-radius:15px;
  height:300px;
}

canvas{
  width:100% !important;
  height:100% !important;
}
</style>
</head>

<body>

<div class="container">

<h1>ðŸ’§ Ultimate Smart Irrigation</h1>

<div class="nav-buttons">
  <button onclick="goPrevious()">â—€ Previous</button>
  <button onclick="goNext()">Next â–¶</button>
</div>

<div class="glass">

<select id="crop">
<option value="">Select Crop</option>
<option>Rice</option>
<option>Wheat</option>
<option>Maize</option>
<option>Sugarcane</option>
<option>Cotton</option>
<option>Groundnut</option>
<option>Tomato</option>
<option>Potato</option>
<option>Chilli</option>
<option>Banana</option>
</select>

<select id="type">
<option>Drip</option>
<option>Sprinkler</option>
<option>Manual</option>
</select>

<input type="number" id="water" placeholder="Water (Liters)">
<input type="date" id="lastDate">
<input type="date" id="nextDate">

<button onclick="addIrrigation()">Add</button>

</div>

<div class="cards">
<div class="card">
<h3>Total Records</h3>
<h2 id="total">0</h2>
</div>

<div class="card">
<h3>Total Water</h3>
<h2 id="totalWater">0 L</h2>
</div>

<div class="card">
<h3>Due Today</h3>
<h2 id="dueToday">0</h2>
</div>
</div>

<table>
<thead>
<tr>
<th>Crop</th>
<th>Type</th>
<th>Water</th>
<th>Next Date</th>
<th>Action</th>
</tr>
</thead>
<tbody id="tableData"></tbody>
</table>

<div class="chart-section">
  <div class="chart-box"><canvas id="barChart"></canvas></div>
  <div class="chart-box"><canvas id="lineChart"></canvas></div>
  <div class="chart-box"><canvas id="pieChart"></canvas></div>
</div>

</div>

<script>

function goPrevious(){
  window.location.href="fertilizer.html";
}

function goNext(){
  window.location.href="report.html";
}

let bar,line,pie;

async function fetchData(){
const res=await fetch("http://localhost:5000/irrigations");
const data=await res.json();

document.getElementById("total").innerText=data.length;

let totalWater=0;
let due=0;
let today=new Date().toISOString().split("T")[0];
let cropMap={},dateMap={};
let tableHTML="";

data.forEach(item=>{
totalWater+=parseFloat(item.water);

if(item.nextDate===today) due++;

cropMap[item.crop]=(cropMap[item.crop]||0)+parseFloat(item.water);
dateMap[item.lastDate]=(dateMap[item.lastDate]||0)+parseFloat(item.water);

tableHTML+=`
<tr>
<td>${item.crop}</td>
<td>${item.type}</td>
<td>${item.water} L</td>
<td>${item.nextDate}</td>
<td>
<button class="action-btn delete" onclick="deleteData(${item.id})">Delete</button>
</td>
</tr>`;
});

document.getElementById("tableData").innerHTML=tableHTML;
document.getElementById("totalWater").innerText=totalWater+" L";
document.getElementById("dueToday").innerText=due;

updateCharts(cropMap,dateMap);
}

function updateCharts(cropMap,dateMap){

if(bar) bar.destroy();
if(line) line.destroy();
if(pie) pie.destroy();

bar=new Chart(barChart,{
type:"bar",
data:{labels:Object.keys(cropMap),
datasets:[{label:"Water per Crop",
data:Object.values(cropMap),
backgroundColor:"rgba(0,255,150,0.6)"}]},
options:{responsive:true,maintainAspectRatio:false}
});

line=new Chart(lineChart,{
type:"line",
data:{labels:Object.keys(dateMap),
datasets:[{label:"Water by Date",
data:Object.values(dateMap),
borderColor:"cyan",
backgroundColor:"rgba(0,255,255,0.2)",
fill:true}]},
options:{responsive:true,maintainAspectRatio:false}
});

pie=new Chart(pieChart,{
type:"pie",
data:{labels:Object.keys(cropMap),
datasets:[{data:Object.values(cropMap),
backgroundColor:["#00c853","#64dd17","#00e676",
"#1de9b6","#00bfa5","#009688","#4db6ac"]}]},
options:{responsive:true,maintainAspectRatio:false}
});
}

async function addIrrigation(){
const crop=document.getElementById("crop").value;
const type=document.getElementById("type").value;
const water=document.getElementById("water").value;
const lastDate=document.getElementById("lastDate").value;
const nextDate=document.getElementById("nextDate").value;

if(!crop||!water||!lastDate||!nextDate){
alert("All fields required");
return;
}

await fetch("http://localhost:5000/add-irrigation",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({crop,type,water,lastDate,nextDate})
});

fetchData();
}

async function deleteData(id){
await fetch(`http://localhost:5000/delete-irrigation/${id}`,{method:"DELETE"});
fetchData();
}

fetchData();
setInterval(fetchData,5000);

</script>

</body>
</html>
